# ============================================================================
# UIP - Urban Intelligence Platform
# Copyright (c) 2025 UIP Team. All rights reserved.
# https://github.com/UIP-Urban-Intelligence-Platform/UIP-Urban_Intelligence_Platform
#
# SPDX-License-Identifier: MIT
# ============================================================================
# File: .github/workflows/dependency-review.yml
# Module: GitHub Actions Workflow - Dependency Review
# Author: Nguyen Nhat Quang (Lead), Nguyen Viet Hoang, Nguyen Dinh Anh Tuan
# Created: 2025-11-20
# Version: 1.0.0
# License: MIT
#
# Description:
#   Reviews dependencies for security vulnerabilities.
# ============================================================================

name: Dependency Review

on:
  pull_request:
    branches: [ main, develop ]

permissions:
  contents: read

jobs:
  dependency-review:
    name: Review Dependencies
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Dependency Review
        uses: actions/dependency-review-action@v4
        with:
          # Fail on moderate+ vulnerabilities
          fail-on-severity: moderate
          
          # Comment results on PR
          comment-summary-in-pr: always
          
          # CRITICAL: Only check runtime dependencies
          # Dev/test tools (webpack, jest, etc.) are excluded
          fail-on-scopes: runtime
          
          # BLACKLIST: Block all copyleft/viral licenses
          # This project is MIT-licensed and must remain MIT-compatible
          deny-licenses: >-
            AGPL-1.0-only, AGPL-1.0-or-later,
            AGPL-3.0-only, AGPL-3.0-or-later,
            GPL-1.0-only, GPL-1.0-or-later,
            GPL-2.0-only, GPL-2.0-or-later,
            GPL-3.0-only, GPL-3.0-or-later,
            LGPL-2.0-only, LGPL-2.0-or-later,
            LGPL-2.1-only, LGPL-2.1-or-later,
            LGPL-3.0-only, LGPL-3.0-or-later,
            MPL-1.0, MPL-1.1, MPL-2.0,
            CC-BY-SA-4.0, CC-BY-NC-4.0, CC-BY-NC-SA-4.0,
            SSPL-1.0, BUSL-1.1,
            OSL-3.0, EUPL-1.2
          
          # Note: Using deny-licenses (blacklist) instead of allow-licenses
          # This allows permissive licenses like MIT, Apache-2.0, BSD, ISC,
          # Unlicense, WTFPL, 0BSD, CC0-1.0, etc. while blocking copyleft
