# SPDX-License-Identifier: MIT
# Copyright (c) 2025 UIP Team. All rights reserved.
#
# UIP - Urban Intelligence Platform
# https://github.com/UIP-Urban-Intelligence-Platform/UIP-Urban_Intelligence_Platform
#
# Module: apps/traffic-web-app/backend/config/agents/eco-twin.yaml
# Author: Nguyen Nhat Quang (Lead), Nguyen Viet Hoang, Nguyen Dinh Anh Tuan
# Created: 2025-11-26
# Modified: 2025-12-06
# Version: 3.0.0
# License: MIT
#
# Description: Eco-Twin Simulator Agent Configuration
# Domain-agnostic configuration for environmental health monitoring.

aairQuality:
  enabled: true
  stellioEntityType: AirQualityObserved
  
  # AQI breakpoints (US EPA standard)
  aqiBreakpoints:
    - category: Good
      min: 0
      max: 50
      healthImpact: "Air quality is satisfactory, and air pollution poses little or no risk"
      color: "#00e400"
    
    - category: Moderate
      min: 51
      max: 100
      healthImpact: "Air quality is acceptable. However, there may be a risk for some people"
      color: "#ffff00"
    
    - category: Unhealthy for Sensitive Groups
      min: 101
      max: 150
      healthImpact: "Members of sensitive groups may experience health effects"
      color: "#ff7e00"
    
    - category: Unhealthy
      min: 151
      max: 200
      healthImpact: "Some members of the general public may experience health effects"
      color: "#ff0000"
    
    - category: Very Unhealthy
      min: 201
      max: 300
      healthImpact: "Health alert: The risk of health effects is increased for everyone"
      color: "#8f3f97"
    
    - category: Hazardous
      min: 301
      max: 500
      healthImpact: "Health warning of emergency conditions: everyone is more likely to be affected"
      color: "#7e0023"

# Weather forecast configuration
weather:
  enabled: true
  provider: openweathermap           # openweathermap | weatherapi | visualcrossing
  apiUrl: https://api.openweathermap.org/data/3.0
  apiKeyEnv: OPENWEATHERMAP_API_KEY
  forecastHours: 4                   # How many hours ahead to forecast

# Dispersion simulation settings
simulation:
  enabled: true
  timeStep: 15                       # Minutes between prediction steps
  maxHoursAhead: 2                   # Maximum forecast horizon
  
  # Dispersion model parameters
  dispersionModel:
    # Rain washout effect
    rainWashoutFactor: 0.08          # PM2.5 reduction per mm/h of rain (8% per mm/h)
    rainWashoutThreshold: 5          # Minimum rain (mm/h) to trigger washout
    
    # Wind dispersion effect
    windDispersionFactor: 0.05       # PM2.5 reduction per m/s of wind (5% per m/s)
    windDispersionThreshold: 5       # Minimum wind speed (m/s) to trigger dispersion
    
    # Natural decay
    baselineDecay: 0.05              # Hourly decay rate (5% per hour)
  
  # Advanced parameters (optional)
  advanced:
    # Temperature inversion effects
    temperatureInversion:
      enabled: false
      thresholdDelta: -2             # Temperature drop (Â°C) indicating inversion
      concentrationMultiplier: 1.5   # Pollution trapping effect
    
    # Traffic patterns
    trafficPatterns:
      enabled: false
      rushHourMultiplier: 1.3        # Pollution increase during rush hours
      rushHours:
        - start: "07:00"
          end: "09:00"
        - start: "17:00"
          end: "19:00"

# AI advice generation
ai:
  enabled: true
  provider: google                   # google | openai | anthropic | local
  model: gemini-2.0-flash-exp        # gemini-2.0-flash-exp | gemini-1.5-flash | gpt-4o
  apiKeyEnv: GEMINI_API_KEY
  maxTokens: 200
  temperature: 0.7
  
  # System prompt template ({language} will be replaced)
  systemPrompt: |
    You are a friendly environmental health advisor in Vietnam.
    
    Your role:
    - Generate empathetic, actionable advice in {language} language
    - Be conversational and warm, not robotic or clinical
    - Use culturally appropriate emojis (Vietnamese audience loves â˜•ğŸŒ§ï¸ğŸŒ¤ï¸ğŸ˜·)
    - Keep advice under 3 sentences
    - Focus on immediate actions user can take
    
    Context awareness:
    - Consider Vietnamese lifestyle (motorbike culture, outdoor cafes, street food)
    - Reference local landmarks if relevant
    - Acknowledge monsoon season, tropical weather patterns
    
    Tone examples:
    âœ… "Trá»i sáº¯p mÆ°a to rá»“i, bá»¥i sáº½ giáº£m bá»›t Ä‘áº¥y! Báº¡n nÃªn ghÃ© quÃ¡n cafe trÃº mÆ°a 30 phÃºt, vá»«a Ä‘á»¡ Æ°á»›t vá»«a hÃ­t thá»Ÿ khÃ´ng khÃ­ sáº¡ch hÆ¡n nhÃ©! ğŸŒ§ï¸â˜•"
    âŒ "Air quality will improve due to precipitation. Recommend waiting 30 minutes indoors."

# User profile management
userProfiles:
  enabled: true
  
  # Default profile when none specified
  defaultProfile:
    activityType: commute            # commute | exercise | outdoor_work | leisure
    transportMode: motorbike         # motorbike | bicycle | walking | car | bus
    language: vi                     # vi | en
    sensitivityLevel: medium         # low | medium | high
  
  # Sensitivity multipliers for risk calculation
  sensitivityMultipliers:
    low: 0.8                         # General healthy adults
    medium: 1.0                      # Default
    high: 1.3                        # Elderly, children, pre-existing conditions
  
  # Health condition profiles
  healthConditions:
    - name: asthma
      description: "Asthma or respiratory conditions"
      riskMultiplier: 1.5
      recommendations:
        - "Keep rescue inhaler accessible"
        - "Use indoor air purifier"
        - "Avoid outdoor exercise when AQI > 100"
    
    - name: heart_disease
      description: "Cardiovascular conditions"
      riskMultiplier: 1.4
      recommendations:
        - "Monitor heart rate during outdoor activities"
        - "Consult doctor if experiencing chest discomfort"
    
    - name: elderly
      description: "Age 65 and above"
      riskMultiplier: 1.3
      recommendations:
        - "Limit outdoor exposure during high pollution"
        - "Stay hydrated"
    
    - name: pregnant
      description: "Pregnancy"
      riskMultiplier: 1.4
      recommendations:
        - "Minimize exposure to traffic pollution"
        - "Use N95 mask in polluted areas"
    
    - name: children
      description: "Children under 12"
      riskMultiplier: 1.3
      recommendations:
        - "Reduce outdoor playtime when AQI > 100"
        - "Keep windows closed during high pollution"

# Publishing configuration
publishing:
  enabled: true
  stellioEntityType: EnvironmentalForecast
  updateIntervalMinutes: 15          # How often to publish new forecasts
  retentionHours: 6                  # How long forecasts remain valid
  
  # Notification triggers
  notifications:
    enabled: true
    triggers:
      - condition: "aqi_increase > 50"
        message: "Cáº£nh bÃ¡o: Cháº¥t lÆ°á»£ng khÃ´ng khÃ­ Ä‘ang xáº¥u Ä‘i nhanh chÃ³ng!"
      
      - condition: "aqi > 150"
        message: "Khuyáº¿n cÃ¡o: Háº¡n cháº¿ ra ngoÃ i, Ä‘eo kháº©u trang N95"
      
      - condition: "rain_coming_soon"
        message: "Tin tá»‘t: MÆ°a sáº¯p Ä‘áº¿n, khÃ´ng khÃ­ sáº½ sáº¡ch hÆ¡n!"

# Domain-specific extensions
domains:
  # Example 1: Urban commuter profile
  urbanCommuter:
    enabled: true
    targetAudience: "Motorbike riders in HCMC"
    adviceTemplates:
      - condition: "aqi >= 150 AND rain_in_30min"
        advice: "Trá»i sáº¯p mÆ°a to rá»“i, bá»¥i sáº½ giáº£m bá»›t Ä‘áº¥y! Báº¡n nÃªn ghÃ© quÃ¡n cafe trÃº mÆ°a 30 phÃºt, vá»«a Ä‘á»¡ Æ°á»›t vá»«a hÃ­t thá»Ÿ khÃ´ng khÃ­ sáº¡ch hÆ¡n nhÃ©! ğŸŒ§ï¸â˜•"
      
      - condition: "aqi >= 150 AND NO rain"
        advice: "KhÃ´ng khÃ­ Ä‘ang Ã´ nhiá»…m náº·ng (AQI {aqi}). Náº¿u pháº£i Ä‘i Ä‘Æ°á»ng, nhá»› Ä‘eo kháº©u trang N95 vÃ  Ä‘Ã³ng kÃ­n kÃ­nh mÅ© báº£o hiá»ƒm nhÃ©! ğŸ˜·ğŸï¸"
      
      - condition: "aqi < 100 AND previously_high"
        advice: "KhÃ´ng khÃ­ Ä‘Ã£ sáº¡ch hÆ¡n nhiá»u rá»“i! ÄÃ¢y lÃ  lÃºc tá»‘t Ä‘á»ƒ Ä‘i dáº¡o, táº­p thá»ƒ dá»¥c ngoÃ i trá»i Ä‘áº¥y! ğŸŒ¤ï¸ğŸš´"
  
  # Example 2: Healthcare facility monitoring
  healthcare:
    enabled: false
    targetAudience: "Hospitals, clinics with vulnerable patients"
    adviceTemplates:
      - condition: "aqi >= 150"
        advice: "Alert: Poor air quality. Advise patients to stay indoors. Enable HEPA filtration in patient wards."
      
      - condition: "aqi >= 200"
        advice: "Critical: Very poor air quality. Postpone non-urgent outdoor patient transfers. Monitor respiratory patients closely."
  
  # Example 3: School outdoor activity management
  education:
    enabled: false
    targetAudience: "Schools, kindergartens"
    adviceTemplates:
      - condition: "aqi >= 100"
        advice: "Moderate air quality. Limit outdoor PE classes. Move activities to covered gymnasium."
      
      - condition: "aqi >= 150"
        advice: "Unhealthy air quality. Cancel all outdoor activities. Keep students indoors with air purification."
      
      - condition: "aqi < 50 AND sunny"
        advice: "Excellent air quality! Perfect day for outdoor field trips and sports activities. â˜€ï¸"

# Integration settings
integration:
  # WebSocket broadcasting
  websocket:
    enabled: true
    broadcastChannel: environment.forecast
    updateIntervalSeconds: 60
  
  # Mobile app push notifications
  pushNotifications:
    enabled: false
    providers:
      - name: firebase
        apiKeyEnv: FIREBASE_API_KEY
      - name: onesignal
        apiKeyEnv: ONESIGNAL_API_KEY
  
  # Social media auto-posting
  socialMedia:
    enabled: false
    platforms:
      - name: twitter
        apiKeyEnv: TWITTER_API_KEY
        template: "ğŸ“¢ Air Quality Update: AQI is {aqi} ({category}). {short_advice}"
      
      - name: facebook
        apiKeyEnv: FACEBOOK_API_KEY
        template: "{advice}\n\n#AirQuality #HCMC #Environment"

# Monitoring and logging
monitoring:
  enabled: true
  logLevel: info                     # debug | info | warn | error
  
  metrics:
    - name: predictions_generated
      type: counter
    
    - name: ai_advice_latency
      type: histogram
    
    - name: aqi_forecast_accuracy
      type: gauge
      description: "Accuracy of AQI predictions vs actual"
    
    - name: user_engagement
      type: counter
      description: "Number of users viewing forecasts"
  
  alerts:
    - condition: "ai_api_failures > 5"
      action: "email_ops_team"
      severity: high
    
    - condition: "forecast_accuracy < 0.7"
      action: "alert_data_science_team"
      severity: medium

# Machine learning enhancements (future)
machineLearning:
  enabled: false
  
  models:
    # Historical pattern learning
    - name: aqi_predictor
      type: lstm
      features:
        - historical_aqi
        - weather_conditions
        - time_of_day
        - day_of_week
        - traffic_density
      target: future_aqi
      horizon: 2_hours
    
    # Personalization model
    - name: advice_personalizer
      type: collaborative_filtering
      features:
        - user_profile
        - historical_engagement
        - feedback_ratings
      target: optimal_advice_style
